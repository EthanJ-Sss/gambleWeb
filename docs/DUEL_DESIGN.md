# 🎭 对赌功能设计方案

## 📋 概述

对赌是两个玩家之间的 1v1 赌局，双方针对同一事件持不同立场，赢家获得输家的积分。

---

## 🎯 三种对赌模式

### 模式A：平注对赌（推荐）

**规则**：双方下注相同金额，赢家通吃

```
示例：
- 张三 发起对赌：「玩家胜利」，下注 100 分
- 李四 接受对赌：「玩家失败」，下注 100 分
- 结果：玩家胜利
- 张三获得 200 分（自己的100 + 李四的100）
- 李四损失 100 分
```

**优点**：简单直观，公平
**缺点**：无法体现选项难度差异

---

### 模式B：赔率对赌

**规则**：发起方设置赔率，接受方按赔率计算收益

```
示例：
- 张三 发起对赌：「玩家胜利」赔率1.5，下注 100 分
- 李四 接受对赌：「玩家失败」（自动计算：赔率2.0）
- 李四需要下注：100 ÷ 2.0 = 50 分（按等额收益计算）

情况1：玩家胜利
  - 张三获得：100 × 1.5 = 150 分（净赚50）
  - 李四损失：50 分

情况2：玩家失败
  - 李四获得：50 × 2.0 = 100 分（净赚50）
  - 张三损失：100 分
```

**赔率自动计算公式**：
```
发起方赔率 = A
接受方赔率 = A / (A - 1)

例如：A=1.5 → B=3.0
例如：A=2.0 → B=2.0（五五开）
例如：A=3.0 → B=1.5
```

**优点**：可以体现选项难度，更有策略性
**缺点**：规则稍复杂

---

### 模式C：自由协商对赌

**规则**：双方自由设置各自的下注金额，不限制比例

```
示例：
- 张三 发起对赌：「玩家胜利」，愿赌 100 分
- 李四 接受：「玩家失败」，愿赌 150 分
- 结果：玩家胜利
- 张三获得：100 + 150 = 250 分
- 李四损失：150 分
```

**优点**：完全自由，适合熟人私下协商
**缺点**：可能出现不公平的赌局

---

## 🔄 对赌流程

### 流程图

```
┌─────────────────────────────────────────────────────────────┐
│                        发起对赌                              │
│  选择关卡 → 选择竞猜内容 → 选择自己的立场 → 设置下注金额     │
│                    → 选择对手（或公开邀请）                   │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                        等待接受                              │
│  对手看到邀请 → 查看对赌内容 → 接受/拒绝                     │
│  （接受时自动选择相反立场，按规则计算下注金额）               │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                        对赌生效                              │
│  双方积分锁定 → 等待对战结果                                 │
└──────────────────────────┬──────────────────────────────────┘
                           │
                           ▼
┌─────────────────────────────────────────────────────────────┐
│                        结算                                  │
│  管理员选择结果 → 自动判定胜负 → 发放积分                    │
└─────────────────────────────────────────────────────────────┘
```

---

## 📊 数据结构

### 对赌表 (duels)

| 字段 | 类型 | 说明 |
|------|------|------|
| id | INT | 主键 |
| stageId | INT | 关卡ID |
| title | VARCHAR | 对赌标题 |
| option1 | VARCHAR | 选项1名称 |
| option2 | VARCHAR | 选项2名称 |
| initiatorId | INT | 发起人ID |
| initiatorOption | INT | 发起人选择（1或2） |
| initiatorAmount | INT | 发起人下注金额 |
| acceptorId | INT | 接受人ID |
| acceptorAmount | INT | 接受人下注金额 |
| mode | ENUM | 对赌模式：equal/odds/free |
| odds | DECIMAL | 赔率（赔率模式使用） |
| status | ENUM | 状态：pending/active/settled/cancelled |
| winnerId | INT | 获胜者ID |
| createdAt | DATETIME | 创建时间 |

---

## 🖥️ 界面设计

### 发起对赌弹窗

```
┌────────────────────────────────────────┐
│  🎭 发起对赌                      [✕]  │
├────────────────────────────────────────┤
│                                        │
│  关卡：[第3关 - 地狱男爵 ▼]            │
│                                        │
│  对赌内容：[胜负 ▼]                    │
│                                        │
│  我选择：                              │
│  ┌──────────┐  ┌──────────┐            │
│  │ 玩家胜利 │  │ 玩家失败 │            │
│  │   ✓     │  │          │            │
│  └──────────┘  └──────────┘            │
│                                        │
│  对赌模式：[平注对赌 ▼]                │
│                                        │
│  我的下注：[100] 分                    │
│                                        │
│  挑战对手：[李四 ▼] 或 [公开邀请]      │
│                                        │
│        [发起对赌]                      │
│                                        │
└────────────────────────────────────────┘
```

### 对赌列表区域

```
┌────────────────────────────────────────────────────────────┐
│  🎭 对赌区                                    [发起对赌]   │
├────────────────────────────────────────────────────────────┤
│                                                            │
│  待接受的对赌：                                            │
│  ┌────────────────────────────────────────────────────┐   │
│  │ 张三 vs ???                                        │   │
│  │ 第3关胜负 | 张三选「玩家胜利」| 100分              │   │
│  │                      [接受挑战] [拒绝]             │   │
│  └────────────────────────────────────────────────────┘   │
│                                                            │
│  进行中的对赌：                                            │
│  ┌────────────────────────────────────────────────────┐   │
│  │ 张三 vs 李四                                       │   │
│  │ 第3关胜负                                          │   │
│  │ 张三「玩家胜利」100分 vs 李四「玩家失败」100分     │   │
│  │                              [结算]                │   │
│  └────────────────────────────────────────────────────┘   │
│                                                            │
└────────────────────────────────────────────────────────────┘
```

---

## 💡 推荐方案

对于现场试玩场景，**推荐使用「平注对赌」模式**：

1. **规则最简单**：双方下注相同金额，赢家通吃
2. **操作最快**：发起→接受→结算，三步完成
3. **公平性好**：不需要复杂的赔率计算

### 简化版实现

```
发起对赌：
  - 选择关卡和竞猜内容
  - 选择自己的立场
  - 输入下注金额
  - 选择对手

接受对赌：
  - 对手自动选择相反立场
  - 下注相同金额
  - 点击接受

结算：
  - 管理员选择正确结果
  - 自动判定胜负并发放积分
```

---

## ❓ 待确认

1. **使用哪种对赌模式？**
   - [ ] 平注对赌（推荐）
   - [ ] 赔率对赌
   - [ ] 自由协商

2. **对赌是否需要对手接受？**
   - [ ] 需要对手接受（推荐）
   - [ ] 管理员直接创建双方对赌

3. **对赌选项是否限制为相反立场？**
   - [ ] 必须选择相反立场（推荐）
   - [ ] 可以选择任意不同选项

4. **是否支持公开邀请（任何人可接受）？**
   - [ ] 支持
   - [ ] 仅支持指定对手

---

## 🎮 使用场景示例

### 场景1：预测胜负
```
张三：我赌他这关肯定过不了，100分！
李四：我不信，我赌他能过，100分！
→ 发起平注对赌
```

### 场景2：预测血量
```
王五：他肯定满血通关，50分！
赵六：不可能，最多中血量，50分！
→ 发起平注对赌（多选项时选择不同选项）
```

### 场景3：预测技能
```
张三：他肯定会被巨人化踩到，200分！
李四：不会的，他走位很好，200分！
→ 发起平注对赌
```

---

请确认你想使用的对赌模式，我来实现代码！


