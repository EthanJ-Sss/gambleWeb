# 🎮 对战竞猜平台 - 多端架构设计文档

## 📋 文档概述

本文档描述对战竞猜平台从单机版改造为**庄家端-玩家端**双端架构的完整设计方案，包括功能设计、技术架构、通信协议和数据同步机制。

---

## 🎯 核心改造目标

| 改造前 | 改造后 |
|--------|--------|
| 单机版，管理员统一操作 | 庄家端 + 玩家端分离 |
| LocalStorage 存储 | 服务器端统一存储 |
| 无实时同步 | WebSocket 实时通信 |
| 管理员代录入下注 | 玩家自主下注 |

---

## 🔑 核心概念定义

### 房间 vs 竞猜轮次

```
┌─────────────────────────────────────────────────────────────────────────┐
│  🏠 房间 (Room) - 持久化容器                                             │
│  ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━  │
│  • 由庄家创建，持续存在直到庄家主动关闭                                    │
│  • 玩家加入后保持在线，可参与多轮竞猜                                      │
│  • 玩家积分在整个房间生命周期内累计                                        │
│                                                                          │
│  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐  ┌─────────────┐     │
│  │  🎯 第1轮    │  │  🎯 第2轮    │  │  🎯 第3轮    │  │  🎯 第N轮    │     │
│  │  竞猜        │  │  竞猜        │  │  竞猜        │  │  竞猜        │     │
│  │             │  │             │  │             │  │             │     │
│  │ 开盘→下注    │  │ 开盘→下注    │  │ 开盘→下注    │  │ 开盘→下注    │     │
│  │ →封盘→结算   │  │ →封盘→结算   │  │ →封盘→结算   │  │ →封盘→结算   │     │
│  └─────────────┘  └─────────────┘  └─────────────┘  └─────────────┘     │
│         │                │                │                │            │
│         └────────────────┴────────────────┴────────────────┘            │
│                              房间持续运行                                 │
└─────────────────────────────────────────────────────────────────────────┘
```

### 生命周期说明

| 概念 | 生命周期 | 结束条件 |
|------|---------|---------|
| **房间 (Room)** | 长期 | 庄家主动关闭房间 |
| **竞猜轮次 (Round)** | 短期 | 庄家完成结算 |
| **玩家会话 (Session)** | 跟随房间 | 玩家离开或房间关闭 |

### 玩家积分持久化

```
玩家加入房间 → 获得初始积分 1000
      ↓
   第1轮竞猜 → 下注 200，赢得 +100 → 积分 1100
      ↓
   第2轮竞猜 → 下注 300，输掉 -300 → 积分 800
      ↓
   第3轮竞猜 → 下注 400，赢得 +200 → 积分 1000
      ↓
    ...持续参与...
      ↓
房间关闭 → 最终积分统计，排名展示
```

---

## 🏛️ 系统架构

### 整体架构图

```
┌─────────────────────────────────────────────────────────────────────────┐
│                              客户端层                                    │
├─────────────────────────────────┬───────────────────────────────────────┤
│          庄家端 (Dealer)         │           玩家端 (Player)             │
│  ┌─────────────────────────┐    │    ┌─────────────────────────────┐   │
│  │ • 创建/管理竞猜场次      │    │    │ • 加入竞猜场次              │   │
│  │ • 设置竞猜内容与赔率     │    │    │ • 查看当前开盘竞猜          │   │
│  │ • 查看所有玩家下注      │    │    │ • 自主下注                  │   │
│  │ • 结算竞猜              │    │    │ • 查看其他玩家下注情况      │   │
│  │ • 管理玩家              │    │    │ • 查看个人积分和排行榜      │   │
│  └─────────────────────────┘    │    └─────────────────────────────┘   │
└─────────────────────────────────┴───────────────────────────────────────┘
                                  │
                                  │ WebSocket / HTTP
                                  ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                              服务器层                                    │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │                      Node.js + Express                           │   │
│  │  ┌────────────┐  ┌────────────┐  ┌────────────┐  ┌────────────┐ │   │
│  │  │ 房间管理   │  │ 竞猜管理   │  │ 下注管理   │  │ 结算引擎   │ │   │
│  │  └────────────┘  └────────────┘  └────────────┘  └────────────┘ │   │
│  │  ┌────────────────────────────────────────────────────────────┐ │   │
│  │  │              WebSocket 实时通信服务 (Socket.IO)             │ │   │
│  │  └────────────────────────────────────────────────────────────┘ │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
                                  │
                                  ▼
┌─────────────────────────────────────────────────────────────────────────┐
│                              数据层                                      │
│  ┌─────────────────────────────────────────────────────────────────┐   │
│  │   SQLite / JSON File (开发) 或 PostgreSQL/MySQL (生产)          │   │
│  └─────────────────────────────────────────────────────────────────┘   │
└─────────────────────────────────────────────────────────────────────────┘
```

### 技术栈选型

| 层级 | 技术选择 | 说明 |
|------|---------|------|
| 前端框架 | 原生 HTML/CSS/JS | 保持简洁，易于部署 |
| 后端框架 | Node.js + Express | 轻量级，JS 全栈 |
| 实时通信 | Socket.IO | 稳定的 WebSocket 封装库 |
| 数据存储 | SQLite / JSON File | 开发阶段简单，可迁移 |

---

## 👔 庄家端设计

### 功能模块

#### 1. 房间管理（持久化房间）
```
┌─────────────────────────────────────────────────────────────────┐
│  🏠 房间管理                                                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  房间状态: 🟢 活跃中                房间码: ABC123               │
│  已进行: 5 轮竞猜                   总下注: 12,500 分            │
│                                                                  │
│  ═══════════════════════════════════════════════════════════    │
│  👥 在线玩家 (6人)                                 [➕ 添加玩家]  │
│  ═══════════════════════════════════════════════════════════    │
│                                                                  │
│  ┌─────────┐ ┌─────────┐ ┌─────────┐ ┌─────────┐               │
│  │ 🥇 李四  │ │ 🥈 张三  │ │ 🥉 陈七  │ │    王五  │               │
│  │ 1425分  │ │ 1150分  │ │ 1100分  │ │ 1000分  │               │
│  │ +425 ▲  │ │ +150 ▲  │ │ +100 ▲  │ │   ±0   │               │
│  │ 🟢 在线  │ │ 🟢 在线  │ │ 🟢 在线  │ │ 🟢 在线  │               │
│  └─────────┘ └─────────┘ └─────────┘ └─────────┘               │
│                                                                  │
│  ┌─────────┐ ┌─────────┐                                        │
│  │   赵六   │ │   周八   │                                        │
│  │  650分  │ │  575分  │                                        │
│  │ -350 ▼  │ │ -425 ▼  │                                        │
│  │ 🟢 在线  │ │ 🟡 离线  │  ← 玩家可暂时离线，积分保留              │
│  └─────────┘ └─────────┘                                        │
│                                                                  │
│  ═══════════════════════════════════════════════════════════    │
│  🎯 当前竞猜状态: 空闲 (可创建新竞猜)                              │
│  ═══════════════════════════════════════════════════════════    │
│                                                                  │
│  ┌──────────────────┐  ┌──────────────────┐  ┌────────────────┐ │
│  │ 🎯 创建新竞猜     │  │ 📊 查看历史记录   │  │ 🔚 关闭房间    │ │
│  └──────────────────┘  └──────────────────┘  └────────────────┘ │
│                                                                  │
│  ⚠️ 关闭房间将结束本场游戏，展示最终排名                           │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 1.1 玩家离线/重连机制
```
玩家状态说明:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

🟢 在线  - 玩家已连接，可正常下注
🟡 离线  - 玩家暂时断开，积分保留，可随时重连
🔴 已退出 - 玩家主动离开房间

重连规则:
• 玩家断线后 30 分钟内可使用相同昵称重连
• 重连后自动恢复积分和下注记录
• 若在竞猜进行中断线，已下注的内容保持有效
```

#### 2. 竞猜创建与管理
```
┌─────────────────────────────────────────────────────────────────┐
│  🎯 创建竞猜                                                     │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  关卡选择: [第3关 - 地狱男爵 ▼]                                  │
│                                                                  │
│  ═══════════════════════════════════════════════════════════    │
│  📋 预设竞猜 (可多选)                                            │
│                                                                  │
│  [✓] 胜负         玩家胜利 ×1.50 | 玩家失败 ×2.50               │
│  [ ] 火圈灼烧     被火圈灼烧 ×1.30 | 从未被灼烧 ×4.00            │
│  [✓] 熔岩喷发     被熔岩命中 ×1.40 | 躲避所有熔岩 ×3.50          │
│  [ ] 流星雨       被流星命中 ×1.40 | 躲避所有流星 ×3.50          │
│  [ ] 零火焰伤害   达成零火伤 ×15.00 | 受到火焰伤害 ×1.05         │
│                                                                  │
│  ┌────────────┐  ┌────────────┐  ┌────────────┐                 │
│  │ 🎲 随机1个  │  │ 🎲 随机3个  │  │ ✅ 全选    │                 │
│  └────────────┘  └────────────┘  └────────────┘                 │
│                                                                  │
│  ═══════════════════════════════════════════════════════════    │
│  🔧 自定义竞猜 (可选)                                            │
│                                                                  │
│  标题: [____________________]                                    │
│  选项1: [______] 赔率: [___]                                     │
│  选项2: [______] 赔率: [___]                                     │
│  [+ 添加选项]                                                    │
│                                                                  │
│  ═══════════════════════════════════════════════════════════    │
│  📊 赔率预设模板                                                 │
│  [标准赔率 ▼]  [高风险赔率]  [保守赔率]  [自定义]                 │
│                                                                  │
│  ┌──────────────────────────────────────────────────────────┐   │
│  │              🚀 开盘 (发布竞猜，玩家可见)                  │   │
│  └──────────────────────────────────────────────────────────┘   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 3. 实时监控面板
```
┌─────────────────────────────────────────────────────────────────┐
│  📊 实时下注监控                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  当前竞猜: 第3关 地狱男爵 - 胜负                                 │
│  状态: 🟢 接受下注中    已下注: 4人/6人                          │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 选项分布                                                 │    │
│  │                                                          │    │
│  │  玩家胜利 ×1.50                                          │    │
│  │  ████████████████████░░░░░░░░░░  850分 (3人)            │    │
│  │  - 张三: 300分                                           │    │
│  │  - 李四: 350分                                           │    │
│  │  - 王五: 200分                                           │    │
│  │                                                          │    │
│  │  玩家失败 ×2.50                                          │    │
│  │  ████████░░░░░░░░░░░░░░░░░░░░░░  300分 (1人)            │    │
│  │  - 赵六: 300分                                           │    │
│  │                                                          │    │
│  │  未下注: 陈七, 周八                                       │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  总下注池: 1150分                                                │
│  预估派奖: 胜利→1275分 | 失败→750分                              │
│                                                                  │
│  ┌────────────────┐  ┌────────────────┐                         │
│  │ 🔒 封盘 (停止下注) │  │ 🏁 进入结算     │                         │
│  └────────────────┘  └────────────────┘                         │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 4. 结算界面
```
┌─────────────────────────────────────────────────────────────────┐
│  🏁 结算竞猜                                        第 5 轮竞猜  │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  竞猜: 第3关 地狱男爵 - 胜负                                     │
│                                                                  │
│  选择正确结果:                                                   │
│  ┌─────────────────────────┐ ┌─────────────────────────┐        │
│  │    🏆 玩家胜利 ×1.50     │ │     💀 玩家失败 ×2.50    │        │
│  │    下注: 850分 (3人)     │ │     下注: 300分 (1人)    │        │
│  └─────────────────────────┘ └─────────────────────────┘        │
│                                                                  │
│  选择后将立即结算并通知所有玩家                                   │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 5. 结算完成 - 继续下一轮
```
┌─────────────────────────────────────────────────────────────────┐
│  ✅ 第 5 轮竞猜结算完成                                          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  竞猜: 第3关 地狱男爵 - 胜负                                     │
│  结果: 🏆 玩家胜利                                               │
│                                                                  │
│  本轮结算:                                                       │
│  ┌────────┬────────┬────────┬────────┬──────────┐               │
│  │ 玩家   │ 选项   │ 下注   │ 结果   │ 积分变化  │               │
│  ├────────┼────────┼────────┼────────┼──────────┤               │
│  │ 张三   │ 胜利   │ 300   │ ✅ 中  │ +150     │               │
│  │ 李四   │ 胜利   │ 350   │ ✅ 中  │ +175     │               │
│  │ 王五   │ 胜利   │ 200   │ ✅ 中  │ +100     │               │
│  │ 赵六   │ 失败   │ 300   │ ❌ 未中│ -300     │               │
│  │ 陈七   │ (未参与)│  -    │   -    │    -     │               │
│  │ 周八   │ (未参与)│  -    │   -    │    -     │               │
│  └────────┴────────┴────────┴────────┴──────────┘               │
│                                                                  │
│  ═══════════════════════════════════════════════════════════    │
│                                                                  │
│  ┌────────────────────────┐  ┌────────────────────────┐         │
│  │  🎯 创建第 6 轮竞猜     │  │  🔚 结束本场 (关闭房间)  │         │
│  └────────────────────────┘  └────────────────────────┘         │
│                                                                  │
│  💡 点击「创建下一轮竞猜」继续游戏，或「结束本场」查看最终排名     │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 6. 关闭房间 - 最终排名
```
┌─────────────────────────────────────────────────────────────────┐
│  🏆 本场游戏结束 - 最终排名                                      │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  房间: ABC123                                                    │
│  总轮次: 8 轮竞猜                                                │
│  参与玩家: 6 人                                                  │
│                                                                  │
│  ═══════════════════════════════════════════════════════════    │
│                      🏆 最终积分排名                              │
│  ═══════════════════════════════════════════════════════════    │
│                                                                  │
│     🥇 第1名  李四    1650分   (+650)   胜率 75%                 │
│     🥈 第2名  张三    1280分   (+280)   胜率 62%                 │
│     🥉 第3名  陈七    1150分   (+150)   胜率 57%                 │
│        第4名  王五    1020分   (+20)    胜率 50%                 │
│        第5名  赵六     680分   (-320)   胜率 37%                 │
│        第6名  周八     520分   (-480)   胜率 25%                 │
│                                                                  │
│  ═══════════════════════════════════════════════════════════    │
│                                                                  │
│  ┌────────────────────────┐  ┌────────────────────────┐         │
│  │  📊 查看详细统计        │  │  🆕 开始新房间          │         │
│  └────────────────────────┘  └────────────────────────┘         │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

### 房间与竞猜状态机

#### 房间生命周期（长期持续）

```
                    庄家创建房间
                         │
                         ▼
                ┌─────────────────┐
                │   🏠 房间活跃     │
                │   (ACTIVE)      │◄─────────────────────────────┐
                │                 │                              │
                │  • 玩家可随时加入 │                              │
                │  • 玩家可随时离开 │                              │
                │  • 积分持续累计   │                              │
                └────────┬────────┘                              │
                         │                                       │
                         │ 庄家进行多轮竞猜                         │
                         ▼                                       │
          ┌──────────────────────────────┐                       │
          │     🔄 竞猜轮次循环            │                       │
          │  ┌─────────────────────────┐ │                       │
          │  │ 每轮: 开盘→下注→封盘→结算 │ │───────────────────────┘
          │  └─────────────────────────┘ │   结算完成，开始下一轮
          └──────────────────────────────┘
                         │
                         │ 庄家主动关闭房间
                         ▼
                ┌─────────────────┐
                │   🔒 房间关闭     │
                │   (CLOSED)      │
                │                 │
                │  • 展示最终排名   │
                │  • 所有玩家断开   │
                └─────────────────┘
```

#### 单轮竞猜状态机（短期循环）

```
         ┌──────────────────────────────────────────────────────────────┐
         │                    单轮竞猜生命周期                            │
         │                                                              │
         │    创建竞猜                                                   │
         │        │                                                     │
         │        ▼                                                     │
         │  ┌───────────┐                                               │
         │  │  已创建    │ ◄──── 竞猜已配置，尚未开放下注                  │
         │  │ (CREATED) │                                               │
         │  └─────┬─────┘                                               │
         │        │ 开盘                                                 │
         │        ▼                                                     │
         │  ┌───────────┐                                               │
         │  │  下注中    │ ◄──── 玩家可下注，实时同步                      │
         │  │  (OPEN)   │       玩家可加入房间并参与                      │
         │  └─────┬─────┘                                               │
         │        │ 封盘                                                 │
         │        ▼                                                     │
         │  ┌───────────┐                                               │
         │  │  已封盘    │ ◄──── 禁止下注，等待结果                        │
         │  │ (LOCKED)  │       新加入玩家只能观战                        │
         │  └─────┬─────┘                                               │
         │        │ 选择结果并结算                                        │
         │        ▼                                                     │
         │  ┌───────────┐                                               │
         │  │  已结算    │ ◄──── 派奖完成，更新积分                        │
         │  │ (SETTLED) │       广播结算结果                             │
         │  └─────┬─────┘                                               │
         │        │                                                     │
         └────────┼─────────────────────────────────────────────────────┘
                  │
                  ▼
         返回房间空闲状态，庄家可创建下一轮竞猜
```

#### 状态转换表

| 当前状态 | 触发事件 | 目标状态 | 说明 |
|---------|---------|---------|------|
| 房间活跃 | 创建竞猜 | 房间活跃 + 竞猜已创建 | 房间状态不变 |
| 竞猜已创建 | 开盘 | 竞猜下注中 | 玩家可开始下注 |
| 竞猜下注中 | 封盘 | 竞猜已封盘 | 停止接受下注 |
| 竞猜已封盘 | 结算 | 竞猜已结算 | 计算并派发奖励 |
| 竞猜已结算 | (自动) | 房间空闲 | 等待下一轮 |
| 房间活跃 | 关闭房间 | 房间关闭 | 结束整场游戏 |

---

## 🎮 玩家端设计

### 功能模块

#### 1. 加入场次
```
┌─────────────────────────────────────────────────────────────────┐
│  🎮 对战竞猜平台 - 玩家端                                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│                    欢迎来到对战竞猜！                             │
│                                                                  │
│            ┌────────────────────────────┐                        │
│            │ 输入房间码: [ABC123    ]   │                        │
│            └────────────────────────────┘                        │
│                                                                  │
│            ┌────────────────────────────┐                        │
│            │ 输入昵称:   [张三      ]   │                        │
│            └────────────────────────────┘                        │
│                                                                  │
│            ┌────────────────────────────────────────────┐        │
│            │              🚪 加入房间                    │        │
│            └────────────────────────────────────────────┘        │
│                                                                  │
│            或扫描庄家分享的二维码直接加入                         │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 2. 下注界面
```
┌─────────────────────────────────────────────────────────────────┐
│  🎮 房间: ABC123                              💰 我的积分: 1000   │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ═══════════════════════════════════════════════════════════    │
│  🎯 当前竞猜: 第3关 地狱男爵 - 胜负                               │
│  状态: 🟢 接受下注中                                             │
│  ═══════════════════════════════════════════════════════════    │
│                                                                  │
│  选择你的预测:                                                   │
│                                                                  │
│  ┌───────────────────────────┐  ┌───────────────────────────┐   │
│  │                           │  │                           │   │
│  │     🏆 玩家胜利           │  │      💀 玩家失败          │   │
│  │        ×1.50              │  │         ×2.50             │   │
│  │                           │  │                           │   │
│  │     已下注: 850分         │  │      已下注: 300分        │   │
│  │     (3人)                 │  │      (1人)                │   │
│  │                           │  │                           │   │
│  └───────────────────────────┘  └───────────────────────────┘   │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 下注积分: [     300     ]                               │    │
│  │                                                          │    │
│  │ 快捷: [100] [200] [300] [500] [全押]                     │    │
│  │                                                          │    │
│  │ 预计收益: 300 × 1.50 = 450分 (净赚 150分)                │    │
│  │                                                          │    │
│  │            ┌─────────────────────────────┐               │    │
│  │            │      ✅ 确认下注             │               │    │
│  │            └─────────────────────────────┘               │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ═══════════════════════════════════════════════════════════    │
│  📢 实时下注动态                                                 │
│  ─────────────────────────────────────────────────────────────  │
│  • 李四 押注「玩家胜利」350分                                    │
│  • 王五 押注「玩家胜利」200分                                    │
│  • 赵六 押注「玩家失败」300分                                    │
│  ═══════════════════════════════════════════════════════════    │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 3. 等待结果界面
```
┌─────────────────────────────────────────────────────────────────┐
│  🎮 房间: ABC123                              💰 我的积分: 700    │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  🔒 当前竞猜已封盘，等待结果...                                   │
│                                                                  │
│  竞猜: 第3关 地狱男爵 - 胜负                                     │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 我的下注:                                                │    │
│  │                                                          │    │
│  │    选项: 玩家胜利 ×1.50                                  │    │
│  │    下注: 300分                                           │    │
│  │    若胜: +150分 (共获得450分)                            │    │
│  │    若负: -300分                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  全场下注分布:                                                   │
│  玩家胜利: 850分 (3人)  ████████████████████░░░░░░░░            │
│  玩家失败: 300分 (1人)  ████████░░░░░░░░░░░░░░░░░░░░            │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 4. 结算结果界面
```
┌─────────────────────────────────────────────────────────────────┐
│  🎮 房间: ABC123                              💰 我的积分: 1150   │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │               🎉 第 5 轮结算完成！🎉                     │    │
│  │                                                          │    │
│  │         竞猜: 第3关 地狱男爵 - 胜负                      │    │
│  │         结果: ✅ 玩家胜利                                │    │
│  │                                                          │    │
│  │   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │    │
│  │                                                          │    │
│  │         🏆 恭喜你猜对了！                                │    │
│  │                                                          │    │
│  │         下注: 300分                                      │    │
│  │         赔率: ×1.50                                      │    │
│  │         获得: 450分                                      │    │
│  │         净赚: +150分                                     │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  本轮全场结算:                                                   │
│  ┌────────┬────────┬────────┬────────┬────────┐                 │
│  │ 玩家   │ 选项   │ 下注   │ 结果   │ 变化   │                 │
│  ├────────┼────────┼────────┼────────┼────────┤                 │
│  │ 张三(我)│ 胜利   │ 300   │ ✅ 中  │ +150  │                 │
│  │ 李四   │ 胜利   │ 350   │ ✅ 中  │ +175  │                 │
│  │ 王五   │ 胜利   │ 200   │ ✅ 中  │ +100  │                 │
│  │ 赵六   │ 失败   │ 300   │ ❌ 未中│ -300  │                 │
│  └────────┴────────┴────────┴────────┴────────┘                 │
│                                                                  │
│  ⏳ 等待庄家开始下一轮竞猜...                                     │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 4.1 等待下一轮界面
```
┌─────────────────────────────────────────────────────────────────┐
│  🎮 房间: ABC123                              💰 我的积分: 1150   │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ═══════════════════════════════════════════════════════════    │
│                    ⏳ 等待下一轮竞猜                              │
│  ═══════════════════════════════════════════════════════════    │
│                                                                  │
│  已完成: 5 轮竞猜                                                │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 📊 我的战绩                                              │    │
│  │                                                          │    │
│  │    参与轮次: 5 轮                                        │    │
│  │    猜中次数: 3 次                                        │    │
│  │    命中率:   60%                                         │    │
│  │    当前积分: 1150 (+150)                                 │    │
│  │    当前排名: 第 2 名                                     │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │ 🏆 当前排行榜                                            │    │
│  │                                                          │    │
│  │    🥇 1. 李四    1425分  (+425)                         │    │
│  │    🥈 2. 张三(我) 1150分  (+150) ◄                       │    │
│  │    🥉 3. 陈七    1100分  (+100)                         │    │
│  │       4. 王五    1000分  (±0)                           │    │
│  │       5. 赵六     650分  (-350)                         │    │
│  │       6. 周八     575分  (-425)                         │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  💡 庄家正在准备下一轮竞猜，请稍候...                             │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 4.2 房间关闭 - 玩家最终结果
```
┌─────────────────────────────────────────────────────────────────┐
│  🎮 房间: ABC123                                                 │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────────────────────────────────────────┐    │
│  │                                                          │    │
│  │               🏁 本场游戏结束！                           │    │
│  │                                                          │    │
│  │         庄家已关闭房间                                   │    │
│  │                                                          │    │
│  │   ━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━   │    │
│  │                                                          │    │
│  │         🥈 你的最终排名: 第 2 名                         │    │
│  │                                                          │    │
│  │         最终积分: 1280分                                 │    │
│  │         总盈亏:   +280分                                 │    │
│  │         参与轮次: 8 轮                                   │    │
│  │         命中率:   62%                                    │    │
│  │                                                          │    │
│  └─────────────────────────────────────────────────────────┘    │
│                                                                  │
│  🏆 最终排行榜:                                                  │
│  ┌────────┬────────┬────────┬────────┐                          │
│  │ 排名   │ 玩家   │ 积分   │ 盈亏   │                          │
│  ├────────┼────────┼────────┼────────┤                          │
│  │ 🥇 1   │ 李四   │ 1650  │ +650  │                          │
│  │ 🥈 2   │ 张三(我)│ 1280  │ +280  │                          │
│  │ 🥉 3   │ 陈七   │ 1150  │ +150  │                          │
│  │   4   │ 王五   │ 1020  │ +20   │                          │
│  │   5   │ 赵六   │  680  │ -320  │                          │
│  │   6   │ 周八   │  520  │ -480  │                          │
│  └────────┴────────┴────────┴────────┘                          │
│                                                                  │
│           ┌─────────────────────────────┐                        │
│           │    🚪 返回首页              │                        │
│           └─────────────────────────────┘                        │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

#### 5. 排行榜与个人中心
```
┌─────────────────────────────────────────────────────────────────┐
│  🏆 积分排行榜                              📊 我的统计          │
├─────────────────────────────────────────────────────────────────┤
│                                                                  │
│  ┌─────────────────────┐    ┌─────────────────────────────┐     │
│  │ 排名                │    │ 个人数据                     │     │
│  │                     │    │                              │     │
│  │ 🥇 1. 李四  1425分  │    │ 昵称: 张三                   │     │
│  │ 🥈 2. 张三  1150分◄ │    │ 当前积分: 1150              │     │
│  │ 🥉 3. 陈七  1100分  │    │ 初始积分: 1000              │     │
│  │    4. 王五  1000分  │    │ 盈亏: +150 (+15%)           │     │
│  │    5. 赵六   650分  │    │                              │     │
│  │    6. 周八   575分  │    │ 参与竞猜: 5次               │     │
│  │                     │    │ 猜中次数: 3次               │     │
│  │                     │    │ 命中率: 60%                 │     │
│  └─────────────────────┘    └─────────────────────────────┘     │
│                                                                  │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🔄 实时通信协议

### WebSocket 事件定义

#### 庄家 → 服务器 事件

| 事件名 | 描述 | 数据结构 |
|--------|------|---------|
| `dealer:create_room` | 创建房间 | `{ dealerName: string }` |
| `dealer:create_bet` | 创建竞猜（新一轮） | `{ stageId: number, bets: BetConfig[] }` |
| `dealer:open_betting` | 开盘 | `{ betId: number }` |
| `dealer:lock_betting` | 封盘 | `{ betId: number }` |
| `dealer:settle_bet` | 结算 | `{ betId: number, winningOptionId: number }` |
| `dealer:next_round` | 开始下一轮 | `{}` |
| `dealer:kick_player` | 踢出玩家 | `{ playerId: string }` |
| `dealer:add_player` | 添加玩家（手动） | `{ playerName: string, initialPoints?: number }` |
| `dealer:close_room` | 关闭房间（结束游戏） | `{ showFinalRanking: boolean }` |

#### 玩家 → 服务器 事件

| 事件名 | 描述 | 数据结构 |
|--------|------|---------|
| `player:join_room` | 加入房间 | `{ roomCode: string, playerName: string }` |
| `player:rejoin_room` | 重新连接房间 | `{ roomCode: string, playerName: string, playerId?: string }` |
| `player:place_wager` | 下注 | `{ betId: number, optionId: number, amount: number }` |
| `player:cancel_wager` | 取消下注 | `{ wagerId: number }` |
| `player:leave_room` | 离开房间 | `{}` |
| `player:get_stats` | 获取个人统计 | `{}` |

#### 服务器 → 所有客户端 广播事件

| 事件名 | 描述 | 数据结构 |
|--------|------|---------|
| `room:player_joined` | 玩家加入 | `{ player: Player }` |
| `room:player_left` | 玩家离开 | `{ playerId: string }` |
| `room:player_reconnected` | 玩家重连 | `{ player: Player }` |
| `room:player_offline` | 玩家离线 | `{ playerId: string }` |
| `room:round_started` | 新一轮开始 | `{ roundNumber: number }` |
| `room:bet_created` | 竞猜创建 | `{ bet: Bet, roundNumber: number }` |
| `room:betting_opened` | 开盘 | `{ betId: number }` |
| `room:betting_locked` | 封盘 | `{ betId: number }` |
| `room:wager_placed` | 新下注 | `{ wager: WagerPublic }` |
| `room:wager_cancelled` | 下注取消 | `{ wagerId: number }` |
| `room:bet_settled` | 结算完成 | `{ bet: Bet, results: SettleResult[], roundNumber: number }` |
| `room:round_ended` | 本轮结束 | `{ roundNumber: number, nextRoundReady: boolean }` |
| `room:closing` | 房间即将关闭 | `{ finalRanking: PlayerRanking[] }` |
| `room:closed` | 房间已关闭 | `{ stats: RoomStats, finalRanking: PlayerRanking[] }` |

#### 服务器 → 单个客户端 事件

| 事件名 | 描述 | 数据结构 |
|--------|------|---------|
| `self:joined` | 成功加入 | `{ player: Player, roomState: RoomState }` |
| `self:rejoined` | 重连成功 | `{ player: Player, roomState: RoomState, missedEvents: Event[] }` |
| `self:wager_confirmed` | 下注确认 | `{ wager: Wager, newBalance: number }` |
| `self:wager_rejected` | 下注拒绝 | `{ reason: string }` |
| `self:settle_result` | 个人结算结果 | `{ result: PersonalResult, newBalance: number }` |
| `self:stats_updated` | 统计更新 | `{ stats: PlayerStats }` |
| `self:kicked` | 被踢出房间 | `{ reason: string }` |
| `error` | 错误消息 | `{ code: string, message: string }` |

### 数据同步时序图

#### 场景1：玩家下注流程

```
  玩家A          服务器          庄家          其他玩家
    │               │              │              │
    │ place_wager   │              │              │
    ├──────────────►│              │              │
    │               │              │              │
    │               │ 验证积分     │              │
    │               │ 扣除积分     │              │
    │               │ 保存下注     │              │
    │               │              │              │
    │ wager_confirmed              │              │
    │◄──────────────┤              │              │
    │               │              │              │
    │               │ wager_placed │              │
    │               ├─────────────►│              │
    │               │              │              │
    │               │ wager_placed │              │
    │               ├─────────────────────────────►│
    │               │              │              │
```

#### 场景2：结算流程（单轮结束，进入下一轮）

```
  庄家           服务器          所有玩家
    │               │              │
    │ settle_bet    │              │
    ├──────────────►│              │
    │               │              │
    │               │ 计算每个玩家的派奖
    │               │ 更新积分
    │               │ 更新玩家统计
    │               │ 保存历史记录
    │               │              │
    │ bet_settled   │              │
    │◄──────────────┤              │
    │               │              │
    │               │ bet_settled (全场结果)
    │               ├─────────────►│
    │               │              │
    │               │ settle_result (个人结果)
    │               ├─────────────►│ (每个玩家单独发送)
    │               │              │
    │               │ round_ended  │
    │               ├─────────────►│  (通知本轮结束)
    │               │              │
    │               │              │  玩家进入"等待下一轮"状态
    │               │              │
    │ create_bet    │              │  庄家创建下一轮竞猜
    ├──────────────►│              │
    │               │              │
    │               │ round_started + bet_created
    │               ├─────────────►│  (通知新一轮开始)
    │               │              │
```

#### 场景3：多轮竞猜完整流程

```
  庄家           服务器          玩家们
    │               │              │
    │ create_room   │              │
    ├──────────────►│              │
    │               │              │
    │ room_created  │              │
    │◄──────────────┤              │
    │               │              │
    │               │              │  玩家陆续加入...
    │               │◄─────────────┤
    │               │              │
    ╔═══════════════════════════════════════════════╗
    ║  循环: 多轮竞猜                                ║
    ╠═══════════════════════════════════════════════╣
    ║    │               │              │           ║
    ║    │ create_bet    │              │           ║
    ║    ├──────────────►│              │           ║
    ║    │               │ bet_created  │           ║
    ║    │               ├─────────────►│           ║
    ║    │               │              │           ║
    ║    │               │  玩家下注... │           ║
    ║    │               │◄─────────────┤           ║
    ║    │               │              │           ║
    ║    │ lock_betting  │              │           ║
    ║    ├──────────────►│              │           ║
    ║    │               │ betting_locked           ║
    ║    │               ├─────────────►│           ║
    ║    │               │              │           ║
    ║    │ settle_bet    │              │           ║
    ║    ├──────────────►│              │           ║
    ║    │               │ bet_settled  │           ║
    ║    │               ├─────────────►│           ║
    ║    │               │ round_ended  │           ║
    ║    │               ├─────────────►│           ║
    ║    │               │              │           ║
    ║    │  [继续下一轮或关闭房间]       │           ║
    ║    │               │              │           ║
    ╚═══════════════════════════════════════════════╝
    │               │              │
    │ close_room    │              │
    ├──────────────►│              │
    │               │              │
    │               │ room_closed (最终排名)
    │               ├─────────────►│
    │               │              │
```

#### 场景4：玩家重连流程

```
  玩家(断线)      服务器          其他客户端
    │               │              │
    ✕ (连接断开)    │              │
                    │              │
                    │ player_offline
                    ├─────────────►│  (通知其他人该玩家离线)
                    │              │
    ... 一段时间后 ...
    │               │              │
    │ rejoin_room   │              │
    ├──────────────►│              │
    │               │              │
    │               │ 验证身份     │
    │               │ 恢复会话     │
    │               │              │
    │ self:rejoined │              │
    │◄──────────────┤              │
    │ (包含当前房间状态、积分、错过的事件)
    │               │              │
    │               │ player_reconnected
    │               ├─────────────►│  (通知其他人该玩家重连)
    │               │              │
```

---

## 📊 数据模型

### 房间 (Room)

```typescript
interface Room {
  id: string;                    // 唯一标识 (UUID)
  code: string;                  // 房间码 (6位字母数字)
  dealerId: string;              // 庄家ID
  dealerName: string;            // 庄家名称
  status: RoomStatus;            // 房间状态（独立于竞猜状态）
  players: Player[];             // 玩家列表
  currentRound: number;          // 当前轮次编号
  currentBet: Bet | null;        // 当前进行中的竞猜（仅一个）
  history: SettledBet[];         // 历史竞猜记录
  createdAt: Date;
  updatedAt: Date;
}

// 房间状态（长生命周期）
enum RoomStatus {
  ACTIVE = 'active',             // 房间活跃中（可接受玩家加入，可开始竞猜）
  CLOSED = 'closed'              // 房间已关闭（游戏结束）
}

// 房间的竞猜状态（短生命周期，每轮重置）
enum RoomBettingPhase {
  IDLE = 'idle',                 // 空闲，无竞猜进行
  BETTING = 'betting',           // 竞猜进行中，接受下注
  LOCKED = 'locked',             // 已封盘，等待结算
  SETTLING = 'settling'          // 结算中
}
```

### 房间统计 (RoomStats)

```typescript
interface RoomStats {
  totalRounds: number;           // 总竞猜轮次
  totalWagered: number;          // 总下注积分
  totalPayout: number;           // 总派奖积分
  startTime: Date;               // 房间开始时间
  endTime?: Date;                // 房间结束时间
}
```

### 玩家 (Player)

```typescript
interface Player {
  id: string;                    // 唯一标识
  name: string;                  // 昵称
  points: number;                // 当前积分
  initialPoints: number;         // 初始积分（固定1000）
  status: PlayerStatus;          // 玩家状态
  joinedAt: Date;
  lastActiveAt: Date;
  
  // 游戏统计（在房间生命周期内累计）
  stats: PlayerStats;
}

enum PlayerStatus {
  ONLINE = 'online',             // 在线
  OFFLINE = 'offline',           // 暂时离线（可重连）
  LEFT = 'left'                  // 已退出房间
}

interface PlayerStats {
  roundsPlayed: number;          // 参与的竞猜轮次
  roundsWon: number;             // 猜中的轮次
  totalWagered: number;          // 累计下注积分
  totalWon: number;              // 累计赢得积分
  totalLost: number;             // 累计输掉积分
  netProfit: number;             // 净盈亏 (= points - initialPoints)
  winRate: number;               // 胜率 (= roundsWon / roundsPlayed)
}
```

### 竞猜 (Bet)

```typescript
interface Bet {
  id: number;
  stageId: number;               // 关卡ID
  stageName: string;             // 关卡名称
  title: string;                 // 竞猜标题
  options: BetOption[];          // 选项列表
  status: BetStatus;             // 竞猜状态
  createdAt: Date;
  lockedAt?: Date;               // 封盘时间
  settledAt?: Date;              // 结算时间
  winningOptionId?: number;      // 获胜选项
}

interface BetOption {
  id: number;
  name: string;                  // 选项名称
  odds: number;                  // 赔率
  totalAmount: number;           // 总下注额
  wagerCount: number;            // 下注人数
}

enum BetStatus {
  CREATED = 'created',           // 已创建
  OPEN = 'open',                 // 开盘中
  LOCKED = 'locked',             // 已封盘
  SETTLED = 'settled'            // 已结算
}
```

### 下注记录 (Wager)

```typescript
interface Wager {
  id: number;
  betId: number;                 // 竞猜ID
  playerId: string;              // 玩家ID
  playerName: string;            // 玩家名称
  optionId: number;              // 选项ID
  optionName: string;            // 选项名称
  amount: number;                // 下注金额
  odds: number;                  // 下注时赔率
  createdAt: Date;
  payout?: number;               // 派奖金额 (结算后)
  profit?: number;               // 盈亏 (结算后)
}

// 广播给其他玩家的下注信息 (隐藏部分敏感信息)
interface WagerPublic {
  id: number;
  playerName: string;
  optionName: string;
  amount: number;
}
```

### 结算结果 (SettleResult)

```typescript
interface SettleResult {
  playerId: string;
  playerName: string;
  optionName: string;
  amount: number;
  won: boolean;
  payout: number;
  profit: number;
  newPoints: number;
  newRank: number;                // 结算后的新排名
}
```

### 玩家排名 (PlayerRanking)

```typescript
interface PlayerRanking {
  rank: number;                   // 排名
  playerId: string;
  playerName: string;
  points: number;                 // 当前积分
  initialPoints: number;          // 初始积分
  netProfit: number;              // 净盈亏
  profitRate: number;             // 收益率 (%)
  roundsPlayed: number;           // 参与轮次
  winRate: number;                // 胜率 (%)
}
```

### 历史竞猜记录 (SettledBet)

```typescript
interface SettledBet {
  id: number;
  roundNumber: number;            // 第几轮
  stageId: number;
  stageName: string;
  title: string;
  options: BetOption[];
  winningOptionId: number;
  winningOptionName: string;
  totalWagered: number;           // 本轮总下注
  totalPayout: number;            // 本轮总派奖
  results: SettleResult[];        // 结算详情
  createdAt: Date;
  settledAt: Date;
}
```

---

## 🔐 安全与校验

### 权限控制

| 操作 | 庄家 | 玩家 |
|------|------|------|
| 创建房间 | ✅ | ❌ |
| 加入房间 | ❌ | ✅ |
| 创建竞猜 | ✅ | ❌ |
| 开盘/封盘 | ✅ | ❌ |
| 结算 | ✅ | ❌ |
| 下注 | ❌ | ✅ |
| 查看下注情况 | ✅ 全部 | ✅ 全部 |
| 踢出玩家 | ✅ | ❌ |

### 下注校验规则

```typescript
function validateWager(player: Player, bet: Bet, optionId: number, amount: number): ValidationResult {
  // 1. 竞猜状态检查
  if (bet.status !== 'open') {
    return { valid: false, reason: '当前竞猜未开盘或已封盘' };
  }
  
  // 2. 积分检查
  if (amount > player.points) {
    return { valid: false, reason: `积分不足，当前积分: ${player.points}` };
  }
  
  // 3. 金额检查
  if (amount <= 0) {
    return { valid: false, reason: '下注金额必须大于0' };
  }
  
  // 4. 选项存在性检查
  const option = bet.options.find(o => o.id === optionId);
  if (!option) {
    return { valid: false, reason: '无效的选项' };
  }
  
  // 5. 重复下注检查 (可选：允许追加或禁止)
  // ...
  
  return { valid: true };
}
```

### 中途加入规则

玩家可以在房间生命周期的任何时刻加入：

| 加入时机 | 处理方式 |
|---------|---------|
| 房间空闲中 | 正常加入，获得1000初始积分，等待下一轮竞猜 |
| 竞猜下注中 | 正常加入，可立即参与当前轮次下注 |
| 竞猜已封盘 | 正常加入，但本轮只能观战，等待下一轮参与 |
| 竞猜结算中 | 正常加入，等待结算完成后参与下一轮 |

```typescript
function handlePlayerJoin(room: Room, playerName: string): JoinResult {
  const player = createPlayer(playerName, 1000);
  room.players.push(player);
  
  // 同步当前房间状态给新玩家
  const roomState = {
    currentRound: room.currentRound,
    currentBet: room.currentBet,
    players: room.players,
    canBet: room.currentBet?.status === 'open',
    history: room.history.slice(-5)  // 最近5轮历史
  };
  
  return { player, roomState };
}
```

### 防作弊机制

1. **服务器端权威**：所有积分计算在服务器端完成
2. **时间戳验证**：下注时间必须在开盘-封盘区间内
3. **操作日志**：记录所有关键操作用于审计
4. **断线重连**：玩家断线后重连时同步最新状态

---

## 📁 项目结构

```
Gamble/
├── client/                      # 前端代码
│   ├── dealer/                  # 庄家端
│   │   ├── index.html
│   │   ├── dealer.js
│   │   └── dealer.css
│   ├── player/                  # 玩家端
│   │   ├── index.html
│   │   ├── player.js
│   │   └── player.css
│   ├── shared/                  # 共享代码
│   │   ├── socket-client.js     # Socket.IO 客户端封装
│   │   ├── utils.js             # 工具函数
│   │   └── common.css           # 公共样式
│   └── assets/                  # 静态资源
│
├── server/                      # 后端代码
│   ├── index.js                 # 服务器入口
│   ├── socket/                  # WebSocket 处理
│   │   ├── index.js             # Socket.IO 初始化
│   │   ├── dealer.js            # 庄家事件处理
│   │   └── player.js            # 玩家事件处理
│   ├── services/                # 业务逻辑
│   │   ├── room.js              # 房间管理
│   │   ├── bet.js               # 竞猜管理
│   │   ├── wager.js             # 下注管理
│   │   └── settle.js            # 结算逻辑
│   ├── models/                  # 数据模型
│   │   ├── room.js
│   │   ├── player.js
│   │   ├── bet.js
│   │   └── wager.js
│   └── data/                    # 数据存储
│       ├── presets.js           # 竞猜预设
│       └── storage.js           # 持久化存储
│
├── BettingPresets.csv           # 竞猜预设配置
├── package.json
└── docs/
    ├── DESIGN.md
    ├── BETTING_DESIGN.md
    └── MULTIPLAYER_DESIGN.md    # 本文档
```

---

## 🚀 开发计划

### 第一阶段：基础架构 (2-3天)

- [ ] 搭建 Node.js + Express 服务器
- [ ] 集成 Socket.IO
- [ ] 实现房间创建与加入
- [ ] 实现基础玩家管理

### 第二阶段：庄家端 (3-4天)

- [ ] 庄家端界面开发
- [ ] 竞猜创建功能（复用现有预设）
- [ ] 开盘/封盘功能
- [ ] 结算功能
- [ ] 实时监控面板

### 第三阶段：玩家端 (3-4天)

- [ ] 玩家端界面开发
- [ ] 加入房间功能
- [ ] 下注界面与交互
- [ ] 实时下注动态展示
- [ ] 结算结果展示

### 第四阶段：同步与优化 (2-3天)

- [ ] 完善实时同步机制
- [ ] 断线重连处理
- [ ] 异常处理与错误提示
- [ ] UI/UX 优化
- [ ] 移动端适配

### 第五阶段：测试与部署 (2天)

- [ ] 功能测试
- [ ] 多人并发测试
- [ ] 部署到服务器
- [ ] 编写使用说明

---

## 📋 附录

### A. 房间码生成规则

```javascript
function generateRoomCode() {
  const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789'; // 排除易混淆字符
  let code = '';
  for (let i = 0; i < 6; i++) {
    code += chars.charAt(Math.floor(Math.random() * chars.length));
  }
  return code;
}
```

### B. 赔率预设模板

| 模板名称 | 描述 | 调整系数 |
|---------|------|---------|
| 标准赔率 | 使用 CSV 中的默认赔率 | 1.0 |
| 高风险赔率 | 放大赔率差异 | 1.2 |
| 保守赔率 | 缩小赔率差异 | 0.8 |
| 玩家友好 | 提高玩家获胜赔率 | +0.1 |
| 庄家友好 | 降低玩家获胜赔率 | -0.1 |

### C. 错误码定义

| 错误码 | 描述 |
|--------|------|
| E001 | 房间不存在 |
| E002 | 房间已满 |
| E003 | 房间已关闭 |
| E004 | 昵称已被使用 |
| E005 | 积分不足 |
| E006 | 竞猜未开盘 |
| E007 | 竞猜已封盘 |
| E008 | 无效的选项 |
| E009 | 权限不足 |
| E010 | 操作超时 |

---

## 📝 更新日志

| 版本 | 日期 | 变更内容 |
|------|------|---------|
| v1.0 | 2026-01-07 | 初始设计文档 |
| v1.1 | 2026-01-07 | 重构为持久化房间模式：房间持续存在直到庄家关闭，支持多轮竞猜循环，添加玩家统计和最终排名功能 |
